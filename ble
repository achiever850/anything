WITH CTE_RETIRE AS (
    SELECT 
        f.factpsgvtjobid AS retirementeligibilitysid,
        f.gvt_retire_plan,
        CASE f.gvt_retire_plan
            WHEN '1' THEN 'FULL CSRS'
            WHEN '2' THEN 'FICA'
            WHEN '4' THEN 'NONE'
            WHEN '5' THEN 'NAF'
            WHEN '6' THEN 'CSRS-SPEC'
            WHEN 'C' THEN 'CSRS-OFFSET'
            WHEN 'E' THEN 'CSRS-OFFSET-SPEC'
            WHEN 'K' THEN 'FERS'
            WHEN 'KR' THEN 'FERS-RAE'
            WHEN 'KF' THEN 'FERS-FRAE'
            WHEN 'MF' THEN 'FERS-SPEC'
            WHEN 'R' THEN 'FICA AND FULL CSRS'
            WHEN 'T' THEN 'FICA AND FULL CSRS SPEC'
            ELSE 'UNKNOWN'
        END AS category
    FROM 
        DATAWAREHOUSE.HRSMART_FACTPSGVTJOB f
),
CTE_DETAIL AS (
    SELECT
        GJ.EMPLID,
        R.category,
        R.gvt_retire_plan
    FROM 
        DATAWAREHOUSE.HRSMART_FACTPSGVTJOB GJ
    LEFT JOIN 
        CTE_RETIRE R ON GJ.factpsgvtjobid = R.retirementeligibilitysid
    WHERE 
        '2024-06-05' BETWEEN GJ.EFFDT AND GJ.EXPDT 
        AND GJ.EMPL_STATUS IN ('A', 'L', 'S', 'P', 'W')
        AND GJ.GVT_STATUS_TYPE IN ('COM', 'COR')
)
SELECT 
    EMPLID,
    gvt_retire_plan,
    category
FROM 
    CTE_DETAIL
WHERE 
    category = 'UNKNOWN';
